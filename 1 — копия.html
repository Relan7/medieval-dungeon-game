<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Средневековое Подземелье</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
            background: #000; /* Добавил черный фон для холста */
        }
        #bottomMenu {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 50px;
            background: #333;
            color: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="bottomMenu">
        <div onclick="changeScreen('arena')">Арена</div>
        <div onclick="changeScreen('dungeon')">Подземелье</div>
        <div onclick="changeScreen('raid')">Рейд</div>
        <div onclick="changeScreen('castle')">Замок</div>
    </div>
    <script>
        // Получаем холст и контекст
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Инициализация переменных
        let currentScreen = 'menu';
        let playerHealth = 100;
        let monsterHealth = 100;
        let levelStars = {}; // Записываем количество звезд за уровень
        let hits = 0; // Считаем количество ударов


        // Изображения
        const backgroundImage = new Image();
        backgroundImage.src = 'background.png'; // Замените путем к вашему изображению фона
        const dungeonGateImage = new Image();
        dungeonGateImage.src = 'dung.png'; // Ваше изображение входа в подземелье
        const monsterImage = new Image();
        monsterImage.src = 'mob.png'; // Замените путем к вашему изображению монстра
        const mapImage = new Image();
        mapImage.src = 'карта.png'; // карта уровней
        const starImage = new Image(); // Загрузите изображение звезды
        starImage.src = 'star.png'; // Путь к вашему изображению звезды

starImage.onload = function() {
    // Функция для отрисовки звезд
    function drawStars(x, y, stars) {
        const starSpacing = 20; // Расстояние между звездами
        for (let i = 0; i < stars; i++) {
            ctx.drawImage(starImage, x + i * starSpacing, y, 15, 15); // Меняйте размеры по необходимости
        }
    }

    // Теперь мы можем безопасно вызывать drawLevelMap, чтобы отрисовать уровни с звездами
    drawLevelMap();
};

function saveProgress() {
    localStorage.setItem('currentLevel', currentLevel.toString());
}

function loadProgress() {
    let savedLevel = localStorage.getItem('currentLevel');
    if (savedLevel) {
        currentLevel = parseInt(savedLevel);
    }
}

// Вызовите loadProgress при запуске игры
loadProgress();

// Вызовите saveProgress каждый раз, когда игрок завершает уровень
function hitMonster() {
    // ... существующий код ...
    if (monsterHealth <= 0) {
        // Монстр побежден, сохраняем прогресс
        saveProgress();
        // ... остальной код ...
    }
}


// Функции для отрисовки экранов
function drawMenu() {
    // Отрисовка фона и кнопок меню
    ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
    // Добавьте отрисовку кнопок для меню здесь
}

function drawDungeonEntrance() {
    ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(dungeonGateImage, canvas.width / 2 - dungeonGateImage.width / 2,
        canvas.height / 2 - dungeonGateImage.height / 2);
}

monsterImage.onload = function() {
    // Теперь, когда изображение монстра загружено, мы можем получить его размеры
    const monsterX = canvas.width / 2 - monsterImage.width / 2;
    const monsterY = canvas.height / 2 - monsterImage.height / 2;
    
    // Обработчик клика для битвы с монстром
    canvas.addEventListener('click', function(event) {
        const rect = canvas.getBoundingClientRect();
        const mouseX = event.clientX - rect.left;
        const mouseY = event.clientY - rect.top;

        // Проверка клика во время битвы с монстром
        if (currentScreen === 'battle') {
            // Проверяем, попадает ли клик в область монстра
            if (mouseX > monsterX && mouseX < monsterX + monsterImage.width &&
                mouseY > monsterY && mouseY < monsterY + monsterImage.height) {
                hitMonster();
            }
        }
    });
};

// ... остальной код ...

// Функция для обработки ударов по монстру
function hitMonster() {
    monsterHealth -= 10; // Уменьшаем здоровье монстра на 10 при каждом ударе
    hits += 1; // Увеличиваем количество ударов
    if (monsterHealth <= 0) {
        monsterHealth = 0;
        // Монстр побежден, переходим на карту уровней
        currentScreen = 'levelMap';
        // Вызовем функцию для отображения карты уровней
        drawLevelMap();
    }
}


// Предположим, что у нас есть объекты уровней с информацией о звездах и состоянии
let levels = [
    { number: 1, stars: 3, completed: true },
    { number: 2, stars: 2, completed: true },
    { number: 3, stars: 1, completed: false },
    { number: 4, stars: 1, completed: true },
    // ... и так далее для каждого уровня
];
let baseMonsterHealth = 100; // Базовое здоровье монстра на первом уровне
let currentLevel = 1;       // Текущий уровень игрока

function startLevel(levelNumber) {
    currentLevel = levelNumber;
    monsterHealth = baseMonsterHealth * Math.pow(1.1, levelNumber - 1);
    console.log("Уровень " + levelNumber + " начинается! Здоровье монстра: " + monsterHealth);
    // Переключитесь на экран битвы
    currentScreen = 'battle';
    drawBattle();
}

function drawLevelMap() {
    ctx.clearRect(0, 0, canvas.width, canvas.height); // Очистка холста
    ctx.drawImage(mapImage, 0, 0, canvas.width, canvas.height); // Рисуем фон карты

    // Рисуем каждый уровень
    levels.forEach((level, index) => {
        // Предположим, что у нас есть функция getLevelPosition, которая возвращает координаты уровня на карте
        const { x, y } = getLevelPosition(index);

        // Рисуем круг или иконку уровня
        ctx.fillStyle = level.completed ? 'gold' : 'silver'; // Золотой для пройденных, серебряный для остальных
        ctx.beginPath();
        ctx.arc(x, y, 25, 0, Math.PI * 2); // Рисуем круг для уровня
        ctx.fill();

        // Рисуем номер уровня
        ctx.fillStyle = 'white';
        ctx.font = '20px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(level.number, x, y + 8);

        // Рисуем звезды
        drawStars(x - 30, y + 35, level.stars); // Рисуем звезды под номером уровня
    });
}

function getLevelPosition(index) {
    // Располагаем уровни в ряды и колонны
    const perRow = 5; // Количество уровней в ряду
    const spacing = 80; // Расстояние между уровнями
    const offsetX = (canvas.width - perRow * spacing) / 2; // Смещение для центрирования
    const offsetY = 100; // Смещение от верха холста

    const x = offsetX + (index % perRow) * spacing;
    const y = offsetY + Math.floor(index / perRow) * spacing;
    return { x, y };
}


        function drawBattle() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(monsterImage, canvas.width / 2 - monsterImage.width / 2,
                canvas.height / 2 - monsterImage.height / 2);
            // Рисуем полосы здоровья
            drawHealthBar(playerHealth, 10, 10, 200, 20, 'green');
            drawHealthBar(monsterHealth, canvas.width - 210, 10, 200, 20, 'red');
        }

        function drawHealthBar(health, x, y, width, height, color) {
            ctx.fillStyle = 'grey';
            ctx.fillRect(x, y, width, height);
            ctx.fillStyle = color;
            ctx.fillRect(x, y, width * health / 100, height);
        }

        function changeScreen(screen) {
            currentScreen = screen;
            // Дополнительная логика для переключения экранов
        }

        canvas.addEventListener('click', function(event) {
    const rect = canvas.getBoundingClientRect();
    const mouseX = event.clientX - rect.left;
    const mouseY = event.clientY - rect.top;

    if (currentScreen === 'menu') {
        // Переходим в подземелье
        currentScreen = 'dungeon';
        drawDungeonEntrance();
    } else if (currentScreen === 'dungeon') {
        const gateCenterX = canvas.width / 2;
        const gateCenterY = canvas.height / 2;
        if (mouseX > gateCenterX - dungeonGateImage.width / 2 &&
            mouseX < gateCenterX + dungeonGateImage.width / 2 &&
            mouseY > gateCenterY - dungeonGateImage.height / 2 &&
            mouseY < gateCenterY + dungeonGateImage.height / 2) {
            currentScreen = 'battle';
            drawBattle();
        }
    } 
});




canvas.addEventListener('click', function(event) {
    const rect = canvas.getBoundingClientRect();
    const mouseX = event.clientX - rect.left;
    const mouseY = event.clientY - rect.top;

    // Проверяем клик на каждом уровне
    levels.forEach((level, index) => {
        const { x, y } = getLevelPosition(index);
        const radius = 25; // Радиус круга уровня

        // Проверяем, находится ли клик в пределах круга уровня
        if (Math.sqrt((mouseX - x) ** 2 + (mouseY - y) ** 2) < radius) {
            // Логика для начала уровня
            startLevel(level.number);
        }
    });
});

function startLevel(levelNumber) {
    console.log("Уровень " + levelNumber + " начинается!");
    // Здесь логика для начала выбранного уровня
}

// Переместите эту проверку вне блока 'else if' для 'dungeon'
canvas.addEventListener('click', function(event) {
    if (currentScreen === 'battle') {
        const monsterX = canvas.width / 2 - monsterImage.width / 2;
        const monsterY = canvas.height / 2 - monsterImage.height / 2;
        if (mouseX > monsterX && mouseX < monsterX + monsterImage.width &&
            mouseY > monsterY && mouseY < monsterY + monsterImage.height) {
            hitMonster();
        }
    }
});

        // Игровой цикл
        function gameLoop() {
            requestAnimationFrame(gameLoop);
            // Отрисовка текущего экрана
            if (currentScreen === 'menu') {
                drawMenu();
            } else if (currentScreen === 'dungeon') {
                drawDungeonEntrance();
            } else if (currentScreen === 'battle') {
                drawBattle();
            }
        }

        // Запуск игрового цикла
        gameLoop();
    </script>
</body>
</html>
